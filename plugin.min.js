tinymce.PluginManager.add('facebook_widgets', function(editor, url){
    // Add a button that opens a window
    editor.addButton('facebook_widgets', {
        tooltip: "Facebook Widget",
        image: url + '/img/facebook_logo.png',
        onclick: function() {
            // Open window
            editor.windowManager.open({
                title: 'Facebook Widget',
                body: [
                    {type: 'container', html: '<p>Insert a page\'s timeline.</p><p>Will appear in editor as "Facebook Widget".</p>'},
                    {type: 'textbox', name: 'page', label: 'facebook.com/'},
                    {type: 'checkbox', name: 'show_cover_photo', label: 'Show cover photo?'},
                    {type: 'checkbox', name: 'show_facepile', label: 'Show faces?'},
                    {type: 'textbox', name: 'widget_height', label: 'Height (px)', value: '500'}
                ],
                onsubmit: function(e) {
                    var widget_height = e.data.widget_height ? e.data.widget_height : 500;

                    // Insert content when the window form is submitted
                    editor.insertContent('<div class="fb-widget"><div class="fb-page" data-height="' + widget_height + '" data-href="https://www.facebook.com/' + e.data.page + '" data-small-header="true" data-show-border="false" data-adapt-container-width="true" data-hide-cover="' + !e.data.show_cover_photo + '" data-show-facepile="' + e.data.show_facepile + '" data-show-posts="true"><div class="fb-xfbml-parse-ignore"><blockquote cite="https://www.facebook.com/' + e.data.page + '"><a href="https://www.facebook.com/' + e.data.page + '">Facebook Widget</a></blockquote></div></div></div>');
                }
            });
        }
    });
});